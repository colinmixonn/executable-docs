time=2024-05-01T11:37:46-07:00 level=error msg=Error creating scenario: markdown file 'https://raw.githubusercontent.com/MicrosoftDocs/azure-docs/main/articles/aks/learn/quick-kubernetes-deploy-cli.md' does not exist
time=2024-05-09T08:59:23-07:00 level=info msg=INI file 'scenarios/azure-docs/articles/aks/learn/quick-kubernetes-deploy-cli.ini' does not exist, skipping...
time=2024-05-09T08:59:23-07:00 level=debug msg=Found HTML block with the content: <!-- expected_similarity=0.3 -->


time=2024-05-09T08:59:23-07:00 level=debug msg=Found HTML block with the content: <!-- expected_similarity=0.3 -->


time=2024-05-09T08:59:23-07:00 level=debug msg=Found HTML block with the content: <!-- LINKS - external -->


time=2024-05-09T08:59:23-07:00 level=debug msg=Found HTML block with the content: <!-- LINKS - internal -->


time=2024-05-09T08:59:23-07:00 level=debug msg=Simalrity score of 0.300000 found
time=2024-05-09T08:59:23-07:00 level=debug msg=Simalrity score of 0.300000 found
time=2024-05-09T08:59:23-07:00 level=debug msg=Found 8 code blocks CodeBlocks=[{azurecli-interactive export RANDOM_ID="$(openssl rand -hex 3)"
export MY_RESOURCE_GROUP_NAME="myAKSResourceGroup$RANDOM_ID"
export REGION="westeurope"
export MY_AKS_CLUSTER_NAME="myAKSCluster$RANDOM_ID"
export MY_DNS_LABEL="mydnslabel$RANDOM_ID"
 Define environment variables {  0 <nil>}} {azurecli-interactive az group create --name $MY_RESOURCE_GROUP_NAME --location $REGION
 Create a resource group {JSON {
  "id": "/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/myAKSResourceGroupxxxxxx",
  "location": "eastus",
  "managedBy": null,
  "name": "testResourceGroup",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": null,
  "type": "Microsoft.Resources/resourceGroups"
}
 0.3 <nil>}} {azurecli-interactive az aks create --resource-group $MY_RESOURCE_GROUP_NAME --name $MY_AKS_CLUSTER_NAME --enable-managed-identity --node-count 1 --generate-ssh-keys
 Create an AKS cluster {  0 <nil>}} {azurecli-interactive az aks get-credentials --resource-group $MY_RESOURCE_GROUP_NAME --name $MY_AKS_CLUSTER_NAME
 Connect to the cluster {  0 <nil>}} {azurecli-interactive kubectl get nodes
 Connect to the cluster {  0 <nil>}} {azurecli-interactive kubectl apply -f aks-store-quickstart.yaml
 Deploy the application {  0 <nil>}} {azurecli-interactive runtime="5 minute"
endtime=$(date -ud "$runtime" +%s)
while [[ $(date -u +%s) -le $endtime ]]
do
   STATUS=$(kubectl get pods -l app=store-front -o 'jsonpath={..status.conditions[?(@.type=="Ready")].status}')
   echo $STATUS
   if [ "$STATUS" == 'True' ]
   then
      export IP_ADDRESS=$(kubectl get service store-front --output 'jsonpath={..status.loadBalancer.ingress[0].ip}')
      echo "Service IP Address: $IP_ADDRESS"
      break
   else
      sleep 10
   fi
done
 Test the application {  0 <nil>}} {azurecli-interactive curl $IP_ADDRESS
 Test the application {JSON <!doctype html>
<html lang="">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="icon" href="/favicon.ico">
      <title>store-front</title>
      <script defer="defer" src="/js/chunk-vendors.df69ae47.js"></script>
      <script defer="defer" src="/js/app.7e8cfbb2.js"></script>
      <link href="/css/app.a5dc49f6.css" rel="stylesheet">
   </head>
   <body>
      <div id="app"></div>
   </body>
</html>
 0.3 <nil>}}]
time=2024-05-09T08:59:23-07:00 level=info msg=Successfully built out the scenario: Quickstart: Deploy an Azure Kubernetes Service (AKS) cluster using Azure CLI
time=2024-05-09T08:59:23-07:00 level=info msg=Changed directory to .
time=2024-05-09T08:59:23-07:00 level=info msg=Executing command: export RANDOM_ID="$(openssl rand -hex 3)"
export MY_RESOURCE_GROUP_NAME="myAKSResourceGroup$RANDOM_ID"
export REGION="westeurope"
export MY_AKS_CLUSTER_NAME="myAKSCluster$RANDOM_ID"
export MY_DNS_LABEL="mydnslabel$RANDOM_ID"
 isInteractive=false
time=2024-05-09T08:59:23-07:00 level=info msg=Command output to stdout:
 
time=2024-05-09T08:59:23-07:00 level=info msg=Command output to stderr:
 
time=2024-05-09T08:59:23-07:00 level=info msg=Executing command: az group create --name $MY_RESOURCE_GROUP_NAME --location $REGION
 isInteractive=false
time=2024-05-09T08:59:28-07:00 level=info msg=Command output to stdout:
 {
  "id": "/subscriptions/d1aa957b-94f5-49ef-b29a-0178c58a7132/resourceGroups/myAKSResourceGroup26bc1e",
  "location": "westeurope",
  "managedBy": null,
  "name": "myAKSResourceGroup26bc1e",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": null,
  "type": "Microsoft.Resources/resourceGroups"
}

time=2024-05-09T08:59:28-07:00 level=info msg=Command output to stderr:
 
time=2024-05-09T08:59:28-07:00 level=debug msg=Comparing JSON strings:
Expected: {
  "id": "/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/myAKSResourceGroupxxxxxx",
  "location": "eastus",
  "managedBy": null,
  "name": "testResourceGroup",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": null,
  "type": "Microsoft.Resources/resourceGroups"
}

Actual{
  "id": "/subscriptions/d1aa957b-94f5-49ef-b29a-0178c58a7132/resourceGroups/myAKSResourceGroup26bc1e",
  "location": "westeurope",
  "managedBy": null,
  "name": "myAKSResourceGroup26bc1e",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": null,
  "type": "Microsoft.Resources/resourceGroups"
}

time=2024-05-09T08:59:28-07:00 level=debug msg=Expected Similarity: 0.300000, Actual Similarity: 0.753646
time=2024-05-09T08:59:28-07:00 level=info msg=Attempting to extract resource group name from command output
time=2024-05-09T08:59:28-07:00 level=info msg=Found resource group resourceGroup=myAKSResourceGroup26bc1e
time=2024-05-09T08:59:28-07:00 level=info msg=Executing command: az aks create --resource-group $MY_RESOURCE_GROUP_NAME --name $MY_AKS_CLUSTER_NAME --enable-managed-identity --node-count 1 --generate-ssh-keys
 isInteractive=false
time=2024-05-09T09:03:44-07:00 level=info msg=Command output to stdout:
 {
  "aadProfile": null,
  "addonProfiles": null,
  "agentPoolProfiles": [
    {
      "artifactStreamingProfile": null,
      "availabilityZones": null,
      "capacityReservationGroupId": null,
      "count": 1,
      "creationData": null,
      "currentOrchestratorVersion": "1.28.5",
      "enableAutoScaling": false,
      "enableCustomCaTrust": false,
      "enableEncryptionAtHost": false,
      "enableFips": false,
      "enableNodePublicIp": false,
      "enableUltraSsd": false,
      "gpuInstanceProfile": null,
      "gpuProfile": null,
      "hostGroupId": null,
      "kubeletConfig": null,
      "kubeletDiskType": "OS",
      "linuxOsConfig": null,
      "maxCount": null,
      "maxPods": 110,
      "messageOfTheDay": null,
      "minCount": null,
      "mode": "System",
      "name": "nodepool1",
      "networkProfile": {
        "allowedHostPorts": null,
        "applicationSecurityGroups": null,
        "nodePublicIpTags": null
      },
      "nodeImageVersion": "AKSUbuntu-2204gen2containerd-202404.16.0",
      "nodeInitializationTaints": null,
      "nodeLabels": null,
      "nodePublicIpPrefixId": null,
      "nodeTaints": null,
      "orchestratorVersion": "1.28",
      "osDiskSizeGb": 128,
      "osDiskType": "Managed",
      "osSku": "Ubuntu",
      "osType": "Linux",
      "podIpAllocationMode": null,
      "podSubnetId": null,
      "powerState": {
        "code": "Running"
      },
      "provisioningState": "Succeeded",
      "proximityPlacementGroupId": null,
      "scaleDownMode": null,
      "scaleSetEvictionPolicy": null,
      "scaleSetPriority": null,
      "securityProfile": {
        "enableSecureBoot": false,
        "enableVtpm": false,
        "sshAccess": "LocalUser"
      },
      "spotMaxPrice": null,
      "tags": null,
      "type": "VirtualMachineScaleSets",
      "upgradeSettings": {
        "drainTimeoutInMinutes": null,
        "maxSurge": "10%",
        "nodeSoakDurationInMinutes": null
      },
      "virtualMachineNodesStatus": null,
      "virtualMachinesProfile": null,
      "vmSize": "Standard_DS2_v2",
      "vnetSubnetId": null,
      "windowsProfile": null,
      "workloadRuntime": "OCIContainer"
    }
  ],
  "aiToolchainOperatorProfile": null,
  "apiServerAccessProfile": null,
  "autoScalerProfile": null,
  "autoUpgradeProfile": {
    "nodeOsUpgradeChannel": "NodeImage",
    "upgradeChannel": null
  },
  "azureMonitorProfile": null,
  "azurePortalFqdn": "myaksclust-myaksresourcegro-d1aa95-qy7gyhfd.portal.hcp.westeurope.azmk8s.io",
  "bootstrapProfile": {
    "artifactSource": "Direct",
    "containerRegistryId": null
  },
  "creationData": null,
  "currentKubernetesVersion": "1.28.5",
  "disableLocalAccounts": false,
  "diskEncryptionSetId": null,
  "dnsPrefix": "myAKSClust-myAKSResourceGro-d1aa95",
  "enableNamespaceResources": null,
  "enablePodSecurityPolicy": false,
  "enableRbac": true,
  "extendedLocation": null,
  "fqdn": "myaksclust-myaksresourcegro-d1aa95-qy7gyhfd.hcp.westeurope.azmk8s.io",
  "fqdnSubdomain": null,
  "httpProxyConfig": null,
  "id": "/subscriptions/d1aa957b-94f5-49ef-b29a-0178c58a7132/resourcegroups/myAKSResourceGroup26bc1e/providers/Microsoft.ContainerService/managedClusters/myAKSCluster26bc1e",
  "identity": {
    "delegatedResources": null,
    "principalId": "e3f4df0c-19fd-42b6-b5ba-d553f65a347c",
    "tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
    "type": "SystemAssigned",
    "userAssignedIdentities": null
  },
  "identityProfile": {
    "kubeletidentity": {
      "clientId": "71e0c17a-7196-4b83-9a9e-c7a7764000ba",
      "objectId": "8784c641-737a-41c9-b4ae-8e4141aa3099",
      "resourceId": "/subscriptions/d1aa957b-94f5-49ef-b29a-0178c58a7132/resourcegroups/MC_myAKSResourceGroup26bc1e_myAKSCluster26bc1e_westeurope/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myAKSCluster26bc1e-agentpool"
    }
  },
  "ingressProfile": null,
  "kubernetesVersion": "1.28",
  "linuxProfile": {
    "adminUsername": "azureuser",
    "ssh": {
      "publicKeys": [
        {
          "keyData": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9tmJ5eJ8obFlLxGev4PlTM8vuydDg6p9VHktH7ghshS4eaXkF8HbTtAR3uyTuRBB8li2uMxM3t0GtStsZ8904Sz2Hbi9A1IdEPEkFjeAnePPyMDn13k/pCj4zK5R+/R15oN1NPhyzTcAUqd94R3MeAVBS4l1tPdx7ljYxIzePTIBGD6LeP3mCCSF7+Sjvf5CD0J9/2hKrc0OJ6hwAqRoGfWcXGQIY0GXbXf/cT1LCf3vISjJa8w8ABmQvOxlKAigVsJorDRc3fVdEziWvkn+FjmdVFKq6/k5oczzWs/Qo6I9OldFLeCYXOUaTUN6liPX3/zscr+BGdiv7kbdcuTeL"
        }
      ]
    }
  },
  "location": "westeurope",
  "maxAgentPools": 100,
  "metricsProfile": {
    "costAnalysis": {
      "enabled": false
    }
  },
  "name": "myAKSCluster26bc1e",
  "networkProfile": {
    "dnsServiceIp": "10.0.0.10",
    "ipFamilies": [
      "IPv4"
    ],
    "kubeProxyConfig": null,
    "loadBalancerProfile": {
      "allocatedOutboundPorts": null,
      "backendPoolType": "nodeIPConfiguration",
      "effectiveOutboundIPs": [
        {
          "id": "/subscriptions/d1aa957b-94f5-49ef-b29a-0178c58a7132/resourceGroups/MC_myAKSResourceGroup26bc1e_myAKSCluster26bc1e_westeurope/providers/Microsoft.Network/publicIPAddresses/cf901535-57ce-4a6c-a924-8dbd0b0d7070",
          "resourceGroup": "MC_myAKSResourceGroup26bc1e_myAKSCluster26bc1e_westeurope"
        }
      ],
      "enableMultipleStandardLoadBalancers": null,
      "idleTimeoutInMinutes": null,
      "managedOutboundIPs": {
        "count": 1,
        "countIpv6": null
      },
      "outboundIPs": null,
      "outboundIpPrefixes": null
    },
    "loadBalancerSku": "standard",
    "monitoring": null,
    "natGatewayProfile": null,
    "networkDataplane": null,
    "networkMode": null,
    "networkPlugin": "kubenet",
    "networkPluginMode": null,
    "networkPolicy": "none",
    "outboundType": "loadBalancer",
    "podCidr": "10.244.0.0/16",
    "podCidrs": [
      "10.244.0.0/16"
    ],
    "serviceCidr": "10.0.0.0/16",
    "serviceCidrs": [
      "10.0.0.0/16"
    ]
  },
  "nodeProvisioningProfile": {
    "mode": "Manual"
  },
  "nodeResourceGroup": "MC_myAKSResourceGroup26bc1e_myAKSCluster26bc1e_westeurope",
  "nodeResourceGroupProfile": null,
  "oidcIssuerProfile": {
    "enabled": false,
    "issuerUrl": null
  },
  "podIdentityProfile": null,
  "powerState": {
    "code": "Running"
  },
  "privateFqdn": null,
  "privateLinkResources": null,
  "provisioningState": "Succeeded",
  "publicNetworkAccess": null,
  "resourceGroup": "myAKSResourceGroup26bc1e",
  "resourceUid": "663cf2e8ecfd8700016cd49c",
  "safeguardsProfile": null,
  "securityProfile": {
    "azureKeyVaultKms": null,
    "customCaTrustCertificates": null,
    "defender": null,
    "imageCleaner": null,
    "imageIntegrity": null,
    "nodeRestriction": null,
    "workloadIdentity": null
  },
  "serviceMeshProfile": null,
  "servicePrincipalProfile": {
    "clientId": "msi",
    "secret": null
  },
  "sku": {
    "name": "Base",
    "tier": "Free"
  },
  "storageProfile": {
    "blobCsiDriver": null,
    "diskCsiDriver": {
      "enabled": true,
      "version": "v1"
    },
    "fileCsiDriver": {
      "enabled": true
    },
    "snapshotController": {
      "enabled": true
    }
  },
  "supportPlan": "KubernetesOfficial",
  "systemData": null,
  "tags": null,
  "type": "Microsoft.ContainerService/ManagedClusters",
  "upgradeSettings": null,
  "windowsProfile": null,
  "workloadAutoScalerProfile": {
    "keda": null,
    "verticalPodAutoscaler": null
  }
}

time=2024-05-09T09:03:44-07:00 level=info msg=Command output to stderr:
 WARNING: The behavior of this command has been altered by the following extension: aks-preview

time=2024-05-09T09:03:44-07:00 level=info msg=Executing command: az aks get-credentials --resource-group $MY_RESOURCE_GROUP_NAME --name $MY_AKS_CLUSTER_NAME
 isInteractive=false
time=2024-05-09T09:03:46-07:00 level=info msg=Command output to stdout:
 
time=2024-05-09T09:03:46-07:00 level=info msg=Command output to stderr:
 WARNING: The behavior of this command has been altered by the following extension: aks-preview
WARNING: Merged "myAKSCluster26bc1e" as current context in /home/naman10parikh/.kube/config

time=2024-05-09T09:03:46-07:00 level=info msg=Executing command: kubectl get nodes
 isInteractive=false
time=2024-05-09T09:03:46-07:00 level=info msg=Command output to stdout:
 
time=2024-05-09T09:03:46-07:00 level=info msg=Command output to stderr:
 
time=2024-05-09T09:03:47-07:00 level=error msg=Error executing command: command exited with 'exit status 126' and the message 'bash: line 1: /usr/local/bin/kubectl: Permission denied
'
time=2024-05-09T09:03:47-07:00 level=info msg=Not fetching resource URIs because we're not in the OCD environment.
time=2024-05-09T09:03:48-07:00 level=info msg=Found deployed resources. resourceURIs=[/subscriptions/d1aa957b-94f5-49ef-b29a-0178c58a7132/resourceGroups/myAKSResourceGroup26bc1e/providers/Microsoft.ContainerService/managedClusters/myAKSCluster26bc1e]
time=2024-05-09T09:03:48-07:00 level=info msg=Changed directory to /home/naman10parikh/NamanCode/executable-docs
time=2024-05-09T09:03:48-07:00 level=error msg=Error executing scenario: command exited with 'exit status 126' and the message 'bash: line 1: /usr/local/bin/kubectl: Permission denied
'
